{
  "$schema": "../../../schemas/subtasks.schema.json",
  "metadata": {
    "scope": "milestone",
    "milestoneRef": "002-ralph-ðŸ’ª",
    "source": "skills-walkthrough-review",
    "generatedAt": "2026-01-28"
  },
  "subtasks": [
    {
      "id": "SUB-124",
      "taskRef": "skills-cleanup",
      "title": "NUKE eval-test-skill and fix eval script cleanup",
      "description": "Delete the eval-test-skill placeholder skill and fix the eval script so it cleans up test artifacts after running. The skill was created as a test artifact by eval.sh but ended up committed. Add .gitignore patterns for eval-test-* artifacts.",
      "done": false,
      "acceptanceCriteria": [
        "Directory .claude/skills/eval-test-skill/ does not exist: test ! -d .claude/skills/eval-test-skill",
        "No reference to eval-test-skill in README.md: ! grep -q 'eval-test-skill' README.md",
        ".gitignore includes eval-test-* pattern: grep -q 'eval-test-' .gitignore",
        "Eval script still passes when run"
      ],
      "filesToRead": [
        ".claude/skills/eval-test-skill/SKILL.md",
        ".claude/scripts/eval.sh",
        "README.md",
        ".gitignore"
      ]
    },
    {
      "id": "SUB-125",
      "taskRef": "skills-cleanup",
      "title": "Rename parallel-code-review skill to code-review",
      "description": "Rename the skill folder from .claude/skills/parallel-code-review/ to .claude/skills/code-review/ and update all references. The name 'parallel' is an implementation detail, not the primary function.",
      "done": false,
      "acceptanceCriteria": [
        "Folder .claude/skills/code-review/ exists with SKILL.md: test -f .claude/skills/code-review/SKILL.md",
        "Folder .claude/skills/parallel-code-review/ does not exist: test ! -d .claude/skills/parallel-code-review",
        "No references to parallel-code-review in .claude or README: ! grep -r 'parallel-code-review' .claude README.md | grep -v backup",
        "aaa review --help works (finds skill at new path)"
      ],
      "filesToRead": [
        ".claude/skills/parallel-code-review/SKILL.md",
        "tools/src/commands/review/index.ts",
        "README.md"
      ]
    },
    {
      "id": "SUB-126",
      "taskRef": "skills-cleanup",
      "title": "Create triage agent specification for code review",
      "description": "Design the triage agent that intelligently picks and curates findings from the synthesizer output. The agent should identify must-review items, group related findings by root cause, and filter low-value noise. Reference context/blocks/patterns/triage.md for the triage pattern.",
      "done": false,
      "acceptanceCriteria": [
        "Agent spec file exists: test -f .claude/agents/code-review/triage.md",
        "Spec defines input format (synthesized findings JSON)",
        "Spec defines output format (selected, grouped, filtered findings)",
        "Spec documents picking criteria: grep -q 'severity\\|confidence\\|root.cause' .claude/agents/code-review/triage.md",
        "Spec references triage pattern: grep -q 'context/blocks/patterns/triage.md' .claude/agents/code-review/triage.md"
      ],
      "filesToRead": [
        ".claude/agents/code-review/synthesizer.md",
        "context/blocks/patterns/triage.md",
        ".claude/agents/code-review/types.md"
      ],
      "blockedBy": ["SUB-125"]
    },
    {
      "id": "SUB-127",
      "taskRef": "skills-cleanup",
      "title": "Integrate triage agent into code review workflow",
      "description": "Update the code-review skill to invoke the triage agent after synthesis. Add Phase 3.5: Triage filtering between synthesis and user triage. User should see 'X findings selected, Y grouped, Z filtered' summary.",
      "done": false,
      "acceptanceCriteria": [
        "SKILL.md workflow includes triage phase: grep -q 'triage\\|Triage' .claude/skills/code-review/SKILL.md",
        "Skill invokes triage agent via Task tool after synthesizer",
        "User sees triage summary with selected/grouped/filtered counts",
        "Filtered findings are logged but not presented for FIX/SKIP decisions"
      ],
      "filesToRead": [
        ".claude/skills/code-review/SKILL.md",
        ".claude/agents/code-review/triage.md"
      ],
      "blockedBy": ["SUB-125", "SUB-126"]
    },
    {
      "id": "SUB-128",
      "taskRef": "skills-cleanup",
      "title": "Add approval gate CLI flag to code review",
      "description": "Add --require-approval flag to aaa review --headless that pauses after triage to show fix summary and requires explicit confirmation before applying changes.",
      "done": false,
      "acceptanceCriteria": [
        "aaa review --help shows --require-approval flag",
        "aaa review --headless --require-approval pauses after triage with summary",
        "Summary shows: N findings to fix, files affected",
        "User must confirm to proceed with fixes",
        "User can abort without applying fixes"
      ],
      "filesToRead": [
        "tools/src/commands/review/index.ts",
        "tools/src/commands/review/types.ts"
      ],
      "blockedBy": ["SUB-125"]
    },
    {
      "id": "SUB-129",
      "taskRef": "skills-cleanup",
      "title": "Add flexible diff target flags to code review CLI",
      "description": "Add CLI flags to control what code changes are reviewed: --base <branch>, --range <from>..<to>, --staged-only, --unstaged-only. Flags are mutually exclusive.",
      "done": false,
      "acceptanceCriteria": [
        "aaa review --help shows --base, --range, --staged-only, --unstaged-only flags",
        "--base <branch> compares HEAD against specified branch",
        "--range <from>..<to> compares specific commits",
        "--staged-only reviews only staged changes",
        "--unstaged-only reviews only unstaged changes",
        "Error if more than one flag specified"
      ],
      "filesToRead": [
        "tools/src/commands/review/index.ts",
        ".claude/skills/code-review/SKILL.md"
      ],
      "blockedBy": ["SUB-125"]
    },
    {
      "id": "SUB-130",
      "taskRef": "skills-cleanup",
      "title": "Update code-review SKILL.md for flexible diff targets",
      "description": "Update the skill's Phase 1 (Gather Diff) to accept optional arguments for diff target specification, matching the CLI flags. Document --base, --range, --staged-only, --unstaged-only in Arguments section.",
      "done": false,
      "acceptanceCriteria": [
        "SKILL.md Arguments section documents diff target flags",
        "Phase 1 instructions show how to handle each argument type",
        "Default behavior unchanged: try HEAD, then origin/main...HEAD",
        "grep 'base\\|range\\|staged' .claude/skills/code-review/SKILL.md returns matches"
      ],
      "filesToRead": [
        ".claude/skills/code-review/SKILL.md",
        "tools/src/commands/review/index.ts"
      ],
      "blockedBy": ["SUB-125", "SUB-129"]
    },
    {
      "id": "SUB-131",
      "taskRef": "skills-cleanup",
      "title": "Define review hook points in ralph config schema",
      "description": "Add review-related hook points to the Ralph config schema that can trigger on review events: onReviewComplete, onCriticalFinding. Follow existing ralph hooks pattern (log, notify, pause).",
      "done": false,
      "acceptanceCriteria": [
        "Ralph config schema includes review hook definitions",
        "Hook points defined: onReviewComplete, onCriticalFinding",
        "Schema validates hook actions: log, notify, pause",
        "Types updated in tools/src/commands/ralph/types.ts"
      ],
      "filesToRead": [
        "docs/planning/schemas/ralph-config.schema.json",
        "tools/src/commands/ralph/types.ts",
        "tools/src/commands/ralph/hooks.ts"
      ]
    },
    {
      "id": "SUB-132",
      "taskRef": "skills-cleanup",
      "title": "Integrate review hooks with ralph build",
      "description": "Add hook execution calls to the code review CLI that trigger Ralph hooks when configured. onReviewComplete fires after triage, onCriticalFinding fires for critical severity findings.",
      "done": false,
      "acceptanceCriteria": [
        "runHeadlessReview() calls executeHook('onReviewComplete', ...) after triage",
        "Critical findings (severity=critical, confidence>=0.9) trigger onCriticalFinding hook",
        "Hooks only fire if ralph config has them configured (graceful no-op otherwise)",
        "Hook context includes: findingCount, criticalCount, sessionId"
      ],
      "filesToRead": [
        "tools/src/commands/review/index.ts",
        "tools/src/commands/ralph/hooks.ts"
      ],
      "blockedBy": ["SUB-125", "SUB-131"]
    },
    {
      "id": "SUB-133",
      "taskRef": "skills-cleanup",
      "title": "Refactor pre-build-validation to reference subtask-spec.md",
      "description": "Update pre-build-validation.md to remove duplicated sizing rules (too_broad, too_narrow) and reference subtask-spec.md instead. Keep only alignment checks (scope_creep, unfaithful). Fix AC count inconsistency (5-7 vs 2-5).",
      "done": false,
      "acceptanceCriteria": [
        "pre-build-validation.md references subtask-spec.md for sizing: grep -q 'subtask-spec.md' context/workflows/ralph/building/pre-build-validation.md",
        "Scope Creep section preserved: grep -q 'Scope Creep\\|scope_creep' context/workflows/ralph/building/pre-build-validation.md",
        "Faithful Implementation section preserved: grep -q 'Faithful\\|unfaithful' context/workflows/ralph/building/pre-build-validation.md",
        "Sizing rules reference spec instead of duplicating: grep -q '@context/workflows/ralph/planning/subtask-spec.md' context/workflows/ralph/building/pre-build-validation.md"
      ],
      "filesToRead": [
        "context/workflows/ralph/building/pre-build-validation.md",
        "context/workflows/ralph/planning/subtask-spec.md"
      ]
    },
    {
      "id": "SUB-134",
      "taskRef": "skills-cleanup",
      "title": "Add argument-hint frontmatter to ralph-plan skill",
      "description": "Add the argument-hint YAML frontmatter field to ralph-plan SKILL.md to show users what arguments to provide. Format: <vision|roadmap|stories|tasks|subtasks> [options]",
      "done": false,
      "acceptanceCriteria": [
        "argument-hint field exists in SKILL.md frontmatter: grep -q 'argument-hint:' .claude/skills/ralph-plan/SKILL.md",
        "Hint shows subcommand options (vision, roadmap, stories, tasks, subtasks)",
        "Format follows existing patterns (angle brackets for required, square for optional)"
      ],
      "filesToRead": [
        ".claude/skills/ralph-plan/SKILL.md",
        ".claude/skills/gh-search/SKILL.md",
        ".claude/skills/interrogate-on-changes/SKILL.md"
      ]
    },
    {
      "id": "SUB-135",
      "taskRef": "skills-cleanup",
      "title": "Add execution instructions for tasks --auto mode",
      "description": "Add execution instructions in ralph-plan SKILL.md for tasks --auto mode (both single-story auto and milestone-wide auto). Currently the execution section only covers interactive mode.",
      "done": false,
      "acceptanceCriteria": [
        "SKILL.md has execution instructions for tasks <story-id> --auto",
        "SKILL.md has execution instructions for tasks --milestone <name> --auto",
        "grep -q 'tasks.*--auto' .claude/skills/ralph-plan/SKILL.md returns match",
        "Mode distinction (interactive vs auto) is clear"
      ],
      "filesToRead": [
        ".claude/skills/ralph-plan/SKILL.md",
        "context/workflows/ralph/planning/tasks-interactive.md",
        "context/workflows/ralph/planning/tasks-auto.md"
      ]
    },
    {
      "id": "SUB-136",
      "taskRef": "skills-cleanup",
      "title": "Add --1-to-1 flag for direct task-to-subtask mapping",
      "description": "Add support for --1-to-1 flag in subtasks generation that bypasses decomposition/sizing logic and maps each task directly to one subtask. Useful when tasks are already well-scoped.",
      "done": false,
      "acceptanceCriteria": [
        "--1-to-1 flag documented in SKILL.md subtasks section: grep -q '\\-\\-1-to-1' .claude/skills/ralph-plan/SKILL.md",
        "subtasks-from-source.md workflow handles --1-to-1 flag",
        "When --1-to-1 is set, sizing/splitting logic is skipped",
        "Documentation explains when to use this flag"
      ],
      "filesToRead": [
        ".claude/skills/ralph-plan/SKILL.md",
        "context/workflows/ralph/planning/subtasks-from-source.md",
        "context/workflows/ralph/planning/subtask-spec.md"
      ]
    },
    {
      "id": "SUB-137",
      "taskRef": "skills-cleanup",
      "title": "Expose --headless flag on ralph review commands",
      "description": "Add --headless option to all review commands (ralph review stories, roadmap, subtasks, gap *). The workflow files already document this pattern but CLI doesn't expose it.",
      "done": false,
      "acceptanceCriteria": [
        "ralph review stories --milestone <path> --headless invokes headless mode",
        "ralph review roadmap --headless invokes headless mode",
        "ralph review subtasks --subtasks <path> --headless invokes headless mode",
        "ralph review gap roadmap --headless invokes headless mode",
        "ralph review gap stories --milestone <path> --headless invokes headless mode",
        "aaa ralph review stories --help shows --headless option"
      ],
      "filesToRead": [
        "tools/src/commands/ralph/index.ts",
        "context/workflows/ralph/review/stories-review-auto.md"
      ]
    },
    {
      "id": "SUB-138",
      "taskRef": "skills-cleanup",
      "title": "Add Tasks Quality Review workflow",
      "description": "Create context/workflows/ralph/review/tasks-review-auto.md for reviewing task definitions against parent stories. Pattern after stories-review-auto.md. Include dimensions: Goal clarity, Plan concreteness, AC testability, Scope boundaries, Story alignment.",
      "done": false,
      "acceptanceCriteria": [
        "File exists: test -f context/workflows/ralph/review/tasks-review-auto.md",
        "Contains review dimensions for tasks: grep -q 'Goal clarity\\|Plan.*concrete\\|AC.*testab' context/workflows/ralph/review/tasks-review-auto.md",
        "References chunked-presentation.md for interactive mode",
        "Documents CLI invocation: aaa ralph review tasks --story <story>"
      ],
      "filesToRead": [
        "context/workflows/ralph/review/stories-review-auto.md",
        "context/blocks/docs/task-template.md"
      ]
    },
    {
      "id": "SUB-139",
      "taskRef": "skills-cleanup",
      "title": "Add Tasks Gap Analysis workflow",
      "description": "Create context/workflows/ralph/review/tasks-gap-auto.md for cold analysis of task coverage against story acceptance criteria. Pattern after stories-gap-auto.md.",
      "done": false,
      "acceptanceCriteria": [
        "File exists: test -f context/workflows/ralph/review/tasks-gap-auto.md",
        "Contains gap analysis dimensions: Coverage, Missing tasks, Technical unknowns, Dependencies",
        "References chunked-presentation.md for interactive mode",
        "Documents CLI invocation: aaa ralph review gap tasks --story <story>"
      ],
      "filesToRead": [
        "context/workflows/ralph/review/stories-gap-auto.md"
      ]
    },
    {
      "id": "SUB-140",
      "taskRef": "skills-cleanup",
      "title": "Add CLI commands for Tasks review",
      "description": "Add ralph review tasks and ralph review gap tasks commands to the CLI, following the pattern of stories review commands.",
      "done": false,
      "acceptanceCriteria": [
        "aaa ralph review tasks --story <path> command exists",
        "aaa ralph review gap tasks --story <path> command exists",
        "Both commands invoke correct workflow files",
        "Help text shows both commands under ralph review --help"
      ],
      "filesToRead": [
        "tools/src/commands/ralph/index.ts"
      ],
      "blockedBy": ["SUB-138", "SUB-139"]
    },
    {
      "id": "SUB-141",
      "taskRef": "skills-cleanup",
      "title": "Add Subtasks Gap Analysis workflow",
      "description": "Create context/workflows/ralph/review/subtasks-gap-auto.md for cold analysis of subtask queue coverage against parent tasks/stories. Pattern after existing gap workflows.",
      "done": false,
      "acceptanceCriteria": [
        "File exists: test -f context/workflows/ralph/review/subtasks-gap-auto.md",
        "Contains gap analysis dimensions: Coverage check, AC verification, Dependency analysis, Risk assessment",
        "References chunked-presentation.md for interactive mode",
        "Documents CLI invocation: aaa ralph review gap subtasks --subtasks <path>"
      ],
      "filesToRead": [
        "context/workflows/ralph/review/subtasks-review-auto.md",
        "context/workflows/ralph/review/stories-gap-auto.md"
      ]
    },
    {
      "id": "SUB-142",
      "taskRef": "skills-cleanup",
      "title": "Add CLI command for Subtasks Gap Analysis",
      "description": "Add ralph review gap subtasks command to the CLI to invoke the new subtasks gap analysis workflow.",
      "done": false,
      "acceptanceCriteria": [
        "aaa ralph review gap subtasks --subtasks <path> command exists",
        "Command invokes subtasks-gap-auto.md workflow",
        "Help text shows command under ralph review gap --help"
      ],
      "filesToRead": [
        "tools/src/commands/ralph/index.ts"
      ],
      "blockedBy": ["SUB-141"]
    },
    {
      "id": "SUB-143",
      "taskRef": "skills-cleanup",
      "title": "Consolidate duplicate gap workflows (planning/ vs review/)",
      "description": "Consolidate planning/roadmap-gap-analysis.md and planning/story-gap-analysis.md into references to the review/ versions. The planning/ versions are redundant with the auto-mode versions. Low priority.",
      "done": false,
      "acceptanceCriteria": [
        "planning/roadmap-gap-analysis.md replaced with reference to review/roadmap-gap-auto.md",
        "planning/story-gap-analysis.md replaced with reference to review/stories-gap-auto.md",
        "No functional change to gap analysis behavior",
        "Skill file updated if it references old paths"
      ],
      "filesToRead": [
        "context/workflows/ralph/planning/roadmap-gap-analysis.md",
        "context/workflows/ralph/review/roadmap-gap-auto.md",
        ".claude/skills/ralph-review/SKILL.md"
      ]
    }
  ]
}
