{
  "$schema": "../../../schemas/subtasks.schema.json",
  "metadata": {
    "scope": "milestone",
    "milestoneRef": "002-ralph-ðŸ’ª"
  },
  "subtasks": [
    {
      "id": "SUB-074",
      "taskRef": "notify-command",
      "title": "Create notify types and Zod schemas",
      "description": "Create tools/src/commands/notify/types.ts with NotifyConfig interface, QuietHoursConfig, Priority type, and Zod schemas for validation. Include error classes (NtfyError, NtfyValidationError, NtfyNetworkError, NtfyRateLimitError) following the pattern from parallel-search/types.ts.",
      "done": false,
      "acceptanceCriteria": [
        "types.ts exists at tools/src/commands/notify/types.ts",
        "NotifyConfig interface matches plan schema (enabled, server, topic, title, defaultPriority, quietHours)",
        "Priority type includes: min, low, default, high, max",
        "Zod schema validates config structure",
        "Error classes extend Error with proper name properties",
        "Unit test tools/tests/lib/notify-types.test.ts passes"
      ],
      "filesToRead": [
        "tools/src/commands/parallel-search/types.ts",
        "tools/src/commands/ralph/types.ts",
        ".claude/plans/hashed-wiggling-gem.md"
      ]
    },
    {
      "id": "SUB-075",
      "taskRef": "notify-command",
      "title": "Create notify config management module",
      "description": "Create tools/src/commands/notify/config.ts with loadNotifyConfig(), saveNotifyConfig(), and isInQuietHours() functions. Config stored at ~/.config/aaa/notify.json. Follow patterns from ralph/config.ts for file operations and defaults merging.",
      "done": false,
      "acceptanceCriteria": [
        "config.ts exists at tools/src/commands/notify/config.ts",
        "loadNotifyConfig() returns merged defaults if file missing",
        "saveNotifyConfig() writes with atomic write pattern",
        "isInQuietHours() handles overnight spans (22:00-08:00) correctly",
        "isInQuietHours() handles same-day spans correctly",
        "DEFAULT_NOTIFY_CONFIG constant exported with sensible defaults",
        "Unit test tools/tests/lib/notify-config.test.ts passes with temp dir"
      ],
      "filesToRead": [
        "tools/src/commands/ralph/config.ts",
        "tools/src/commands/notify/types.ts",
        ".claude/plans/hashed-wiggling-gem.md"
      ],
      "blockedBy": ["SUB-074"]
    },
    {
      "id": "SUB-076",
      "taskRef": "notify-command",
      "title": "Create ntfy HTTP client module",
      "description": "Create tools/src/commands/notify/client.ts with sendNotification() function that POSTs to ntfy.sh API. Include retry logic (2 retries, exponential backoff), timeout handling (30s), and priority mapping (name to numeric 1-5). Handle errors by throwing typed error classes.",
      "done": false,
      "acceptanceCriteria": [
        "client.ts exists at tools/src/commands/notify/client.ts",
        "sendNotification() accepts message, title, priority, topic, server",
        "Priority names (min, low, default, high, max) map to numeric (1-5)",
        "Retries on 429, 500, 502, 503, 504 with exponential backoff",
        "Throws NtfyNetworkError on connection failure",
        "Throws NtfyRateLimitError on 429",
        "Unit test tools/tests/lib/notify-client.test.ts passes with mocked fetch"
      ],
      "filesToRead": [
        "tools/src/commands/parallel-search/parallel-client.ts",
        "tools/src/commands/notify/types.ts",
        ".claude/plans/hashed-wiggling-gem.md"
      ],
      "blockedBy": ["SUB-074"]
    },
    {
      "id": "SUB-077",
      "taskRef": "notify-command",
      "title": "Create notify CLI command with subcommands and docs",
      "description": "Create tools/src/commands/notify/index.ts with Commander.js command structure: notify <message>, notify on, notify off, notify status, notify config (set/show/test). Register in tools/src/cli.ts. Follow patterns from ralph/index.ts for subcommand structure. Update README.md with command documentation.",
      "done": false,
      "acceptanceCriteria": [
        "index.ts exists at tools/src/commands/notify/index.ts",
        "aaa notify --help shows all subcommands",
        "aaa notify <message> sends notification with config resolution (CLI > env > config > defaults)",
        "aaa notify on/off toggles enabled flag in config",
        "aaa notify status shows current configuration status",
        "aaa notify config set --topic <topic> works",
        "aaa notify config show displays config",
        "aaa notify config test sends test notification",
        "Registered in tools/src/cli.ts",
        "E2E test tools/tests/e2e/notify.test.ts passes",
        "README.md CLI Tools section documents aaa notify command",
        "All subcommands and flags documented in README",
        "Claude Code hook integration example in README"
      ],
      "filesToRead": [
        "tools/src/commands/ralph/index.ts",
        "tools/src/cli.ts",
        "tools/src/commands/notify/config.ts",
        "tools/src/commands/notify/client.ts",
        "README.md",
        ".claude/plans/hashed-wiggling-gem.md"
      ],
      "blockedBy": ["SUB-075", "SUB-076"]
    },
    {
      "id": "SUB-078",
      "taskRef": "notify-command",
      "title": "Add notify init wizard command",
      "description": "Add interactive init command to tools/src/commands/notify/index.ts that prompts for topic, server URL, quiet hours configuration, sends test notification, and shows next steps. Use ora for spinner during test notification.",
      "done": false,
      "acceptanceCriteria": [
        "aaa notify init prompts for topic name (required)",
        "aaa notify init prompts for server URL with default https://ntfy.sh",
        "aaa notify init asks about quiet hours and prompts start/end if enabled",
        "aaa notify init sends test notification and reports success/failure",
        "aaa notify init shows next steps (install app, subscribe to topic, add hook)",
        "aaa notify init warns if config already exists",
        "E2E test added for init command flow"
      ],
      "filesToRead": [
        "tools/src/commands/notify/index.ts",
        "tools/src/commands/setup/index.ts",
        ".claude/plans/hashed-wiggling-gem.md"
      ],
      "blockedBy": ["SUB-077"]
    },
    {
      "id": "SUB-079",
      "taskRef": "notify-command",
      "title": "Add silent behavior when unconfigured",
      "description": "Implement silent exit (exit 0, no output) when topic is empty or notifications disabled. This makes notify safe to include in Claude Code hooks before running init - it just does nothing until configured.",
      "done": false,
      "acceptanceCriteria": [
        "aaa notify 'test' with empty topic exits 0 silently (no output)",
        "aaa notify 'test' with notifications disabled exits 0 silently",
        "E2E test verifies silent behavior with missing config file",
        "E2E test verifies silent behavior with empty topic in config"
      ],
      "filesToRead": [
        "tools/src/commands/notify/index.ts",
        ".claude/plans/hashed-wiggling-gem.md"
      ],
      "blockedBy": ["SUB-077"]
    },
    {
      "id": "SUB-080",
      "taskRef": "notify-command",
      "title": "Add --dry-run and --quiet flags",
      "description": "Add --dry-run flag to aaa notify <message> that shows what would be sent without sending. Add -q/--quiet flag to suppress output on success. These are UX enhancements for testing and scripting.",
      "done": false,
      "acceptanceCriteria": [
        "aaa notify 'test' --dry-run outputs notification details without sending",
        "--dry-run shows: topic, server, title, priority, message",
        "-q/--quiet flag suppresses output on success",
        "E2E test verifies dry-run output format",
        "README updated with --dry-run and --quiet flag documentation"
      ],
      "filesToRead": [
        "tools/src/commands/notify/index.ts",
        "README.md",
        ".claude/plans/hashed-wiggling-gem.md"
      ],
      "blockedBy": ["SUB-079"]
    }
  ]
}
