/*! @author Huan Luo <dukeluo@outlook.com> (https://shaiwang.life) */
"use strict";var e=require("path"),t=require("micromatch"),o=require("is-glob");const n='The naming pattern object "{{ value }}" does not appear to be an Object type, please double-check it and try again',r='There is an invalid pattern "{{ value }}", please double-check it and try again',a=e=>`https://github.com/dukeluo/eslint-plugin-check-file/blob/main/docs/rules/${e}.md`,i=/^<(\d+)>$/,s=/^[A-Za-z]:\\/,l=e=>"[object Object]"===Object.prototype.toString.call(e),c=e=>null==e,d=e=>""===e||(e=>null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e))(e)&&0===e.length||l(e)&&0===Object.keys(e).length,p=(...e)=>t=>e.reduce(((e,t)=>t(e)),t),m=p(d,(e=>!e)),g=t=>e.posix.basename(t),u=t=>e.posix.join(e.posix.dirname(t),e.posix.sep),f=(e,t=!1)=>{const o=(e=>{const t=[];let o=0;for(let n=0;n<e.length;n++)"["===e[n]?o++:"]"===e[n]?o--:"."===e[n]&&0===o&&t.push(n);return t})(e),n=t?o[0]:o[o.length-1];return e.substring(0,n)},h=t=>t.split(e.posix.sep).filter(m),y=t=>{const o=h(t);let n=[];for(let t=0;t<o.length;t++)o.slice(t).reduce(((t,o,r)=>{const a=e.posix.join(t,o,e.posix.sep);return r>=1&&n.push(a),a}),"");return n.unshift(e.posix.join(o[0],e.posix.sep)),n},b=t=>t.split(e.sep).join(e.posix.sep),v=e=>e.replace(s,""),_=t=>{const o=(n=t.physicalFilename,r=t.cwd,n.replace(e.join(r,e.sep),""));var n,r;return p(v,b)(o)},P="+([a-z])*([a-z0-9])*([A-Z]*([a-z0-9]))",A="+([a-z])*([a-z0-9])*(-+([a-z0-9]))";var E=Object.freeze({__proto__:null,CAMEL_CASE:P,FLAT_CASE:"+([a-z0-9])",KEBAB_CASE:A,PASCAL_CASE:"*([A-Z]*([a-z0-9]))",SCREAMING_SNAKE_CASE:"+([A-Z])*([A-Z0-9])*(_+([A-Z0-9]))",SNAKE_CASE:"+([a-z])*([a-z0-9])*(_+([a-z0-9]))"});const x=`\\[${P}\\]`,M=`\\[...${P}\\]`,j=`\\[\\[...${P}\\]\\]`,S=`@(${A}|+([a-z])?(.+([a-z]))|${x}|${M}|${j}|${`\\(${A}\\)`}|${`\\@${A}`}|${`\\_${A}`})`,O=`@(_app|_document|404|500|_error|index|${P}|${x}|${M}|${j})`;var T=Object.freeze({__proto__:null,NEXT_JS_APP_ROUTER_CASE:S,NEXT_JS_PAGE_ROUTER_FILENAME_CASE:O});const $=([e,o],n)=>{const r=t.capture(e,n);if(c(r))return[e,o];const a=[...o.matchAll(new RegExp(i,"g"))];if(d(a))return[e,o];const s=a.reduce(((t,n)=>{const a=+n[1];if(c(r[a]))throw{type:"invalidPrefinedMatch",payload:{namingPattern:o,filenamePattern:e}};return t.replace(n[0],r[a])}),o);return[e,s]},k=(e,o,n,r)=>t.isMatch(e,o)?n&&r&&t.isMatch(n,E[r]||T[r]||r)?void 0:{path:e,pattern:r}:void 0,z=(e,t,o)=>{if(!l(e))return{type:"invalidObject",payload:e};for(const[n,r]of Object.entries(e)){if(!t(n))return{type:"invalidPattern",payload:n};if(!o(r))return{type:"invalidPattern",payload:r}}},I=e=>Object.keys(E).includes(e),C=o,L=e=>C(e)||I(e)||(e=>["NEXT_JS_APP_ROUTER_CASE"].includes(e))(e);var N={meta:{type:"layout",docs:{description:"The filename should be blocklisted",category:"Layout & Formatting",recommended:!1,url:a("filename-blocklist")},fixable:null,schema:[{additionalProperties:{type:"string"}},{type:"object",properties:{errorMessage:{type:"string"}}}],messages:{invalidObject:n,invalidPattern:r,noMatch:'The filename "{{ filename }}" matches the blocklisted "{{ blockListPattern }}" pattern, use a pattern like "{{ suggestion }}" instead'}},create(e){const t=t=>{const o=e.options[0],n=e.options[1]?.errorMessage??"",r=z(o,C,d(n)?C:()=>!0);if(r)return void e.report({node:t,messageId:r.type,data:{value:r.payload}});const a=_(e),i=g(a);for(const[r,s]of Object.entries(o)){if(k(a,r))return void(m(n)?e.report({node:t,message:n,data:{target:i,pattern:r}}):e.report({node:t,messageId:"noMatch",data:{filename:i,blockListPattern:r,suggestion:s}}))}};return{Document:t,Program:t,root:t,StyleSheet:t}}},R={meta:{type:"layout",docs:{description:"The filename should follow the filename naming convention",category:"Layout & Formatting",recommended:!1,url:a("filename-naming-convention")},fixable:null,schema:[{additionalProperties:{type:"string"}},{type:"object",properties:{ignoreMiddleExtensions:{type:"boolean"},errorMessage:{type:"string"}}}],messages:{invalidObject:n,invalidPattern:r,invalidPrefinedMatch:'The prefined match "{{ namingPattern }}" is not found in the pattern "{{ filenamePattern }}", please double-check it and try again',noMatch:'The filename "{{ filename }}" does not match the "{{ originalNamingPattern }}" pattern'}},create(e){const t=t=>{const o=e.options[0],n=z(o,C,(e=>{return C(t=e)||I(t)||i.test(t)||(e=>["NEXT_JS_PAGE_ROUTER_FILENAME_CASE"].includes(e))(e);var t}));if(n)return void e.report({node:t,messageId:n.type,data:{value:n.payload}});const r=_(e),a=g(r),s=e.options[1]?.ignoreMiddleExtensions??!1,l=e.options[1]?.errorMessage??"";for(const[i,c]of Object.entries(o))try{const[e,t]=$([i,c],r);if(k(r,e,f(a,s),t))throw{type:"noMatch",payload:{filename:a,originalNamingPattern:c}}}catch(n){m(l)&&"noMatch"===n.type?e.report({node:t,message:l,data:{target:n.payload.filename,pattern:n.payload.originalNamingPattern}}):e.report({node:t,messageId:n.type,data:n.payload})}};return{Document:t,Program:t,root:t,StyleSheet:t}}},w={meta:{type:"layout",docs:{description:"The folder should match the naming pattern specified by its file",category:"Layout & Formatting",recommended:!1,url:a("folder-match-with-fex")},fixable:null,schema:[{additionalProperties:{type:"string"}},{type:"object",properties:{errorMessage:{type:"string"}}}],messages:{invalidObject:n,invalidPattern:r,noMatch:'The folder of the file "{{ filename }}" does not match the "{{ folderPattern }}" pattern'}},create(e){const t=t=>{const o=e.options[0],n=z(o,C,C);if(n)return void e.report({node:t,messageId:n.type,data:{value:n.payload}});const r=_(e),a=g(r),i=u(r),s=e.options[1]?.errorMessage??"";for(const[n,r]of Object.entries(o)){if(k(a,n,i,r))return void(m(s)?e.report({node:t,message:s,data:{target:a,pattern:r}}):e.report({node:t,messageId:"noMatch",data:{filename:a,folderPattern:r}}))}};return{Document:t,Program:t,root:t,StyleSheet:t}}},F={meta:{type:"layout",docs:{description:"The folder should follow the folder naming convention",category:"Layout & Formatting",recommended:!1,url:a("folder-naming-convention")},fixable:null,schema:[{additionalProperties:{type:"string"}},{type:"object",properties:{errorMessage:{type:"string"},ignoreWords:{type:"array",items:{type:"string"}}}}],messages:{invalidObject:n,invalidPattern:r,noMatch:'The folder "{{ folder }}" does not match the "{{ namingPattern }}" pattern'}},create(e){const o=o=>{const n=e.options[0],r=z(n,C,L);if(r)return void e.report({node:o,messageId:r.type,data:{value:r.payload}});const a=_(e),i=u(a),s=e.options[1]?.errorMessage??"",l=e.options[1]?.ignoreWords??[];for(const[r,a]of Object.entries(n))if(t.isMatch(i,r,{contains:!0}))for(const n of y(i)){const i=t.capture(r,n,{dot:!0});if(c(i))continue;const d=i.filter(m).reduce(((e,t)=>e.concat(h(t))),[]);for(const n of d)if(!l.includes(n)&&!t.isMatch(n,E[a]||T[a]||a))return void(m(s)?e.report({node:o,message:s,data:{target:n,pattern:a}}):e.report({node:o,messageId:"noMatch",data:{folder:n,namingPattern:a}}))}};return{Document:o,Program:o,root:o,StyleSheet:o}}};const Z={meta:{name:"eslint-plugin-check-file",version:"3.3.1"},rules:{"filename-blocklist":N,"filename-naming-convention":R,"folder-match-with-fex":w,"folder-naming-convention":F,"no-index":{meta:{type:"layout",docs:{description:'A file cannot be named "index"',category:"Layout & Formatting",recommended:!1,url:a("no-index")},fixable:null,schema:[{type:"object",properties:{ignoreMiddleExtensions:{type:"boolean"},errorMessage:{type:"string"}}}],messages:{noIndex:'The filename "index" is not allowed'}},create(e){const t=t=>{const o=e.options[0]?.ignoreMiddleExtensions??!1,n=e.options[0]?.errorMessage??"",r=_(e),a=g(r);"index"!==f(a,o)||(m(n)?e.report({node:t,message:n,data:{target:a}}):e.report({node:t,messageId:"noIndex"}))};return{Document:t,Program:t,root:t,StyleSheet:t}}}},processors:{"eslint-processor-check-file":{preprocess:(e,t)=>[{text:"",filename:t}],postprocess:e=>[].concat(...e),supportsAutofix:!0}}};module.exports=Z;
